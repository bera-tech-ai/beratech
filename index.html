<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEVS ARENA - Ultimate Developer Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#0ea5e9',
                        secondary: '#7e22ce',
                        dark: '#0f172a',
                        darker: '#020617'
                    },
                    backdropBlur: {
                        xs: '2px',
                    }
                }
            }
        }
    </script>
    <style>
        .glassmorphic {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
        }
        .neon-glow {
            box-shadow: 0 0 20px rgba(14, 165, 233, 0.3);
        }
        .code-editor {
            background: #1e293b;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        .syntax-js { color: #f7df1e; }
        .syntax-html { color: #e34f26; }
        .syntax-css { color: #1572b6; }
        .syntax-py { color: #3776ab; }
    </style>
</head>
<body class="gradient-bg text-white min-h-screen">
    <!-- Navigation -->
    <nav class="glassmorphic fixed w-full z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-code text-2xl text-primary"></i>
                    <span class="text-xl font-bold">DEVS ARENA</span>
                </div>
                
                <div class="hidden md:flex space-x-6">
                    <a href="#dashboard" class="hover:text-primary transition">Dashboard</a>
                    <a href="#chat" class="hover:text-primary transition">Chat</a>
                    <a href="#projects" class="hover:text-primary transition">Projects</a>
                    <a href="#apis" class="hover:text-primary transition">APIs</a>
                    <a href="#ai" class="hover:text-primary transition">AI Assistant</a>
                    <a href="#school" class="hover:text-primary transition">Devs School</a>
                    <a href="#tools" class="hover:text-primary transition">Tools</a>
                </div>

                <div class="flex items-center space-x-4">
                    <button id="themeToggle" class="p-2 rounded-lg glassmorphic">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div id="authButtons" class="flex space-x-3">
                        <button onclick="showAuthModal('login')" class="px-4 py-2 rounded-lg glassmorphic hover:neon-glow transition">Login</button>
                        <button onclick="showAuthModal('register')" class="px-4 py-2 bg-primary rounded-lg hover:neon-glow transition">Register</button>
                    </div>
                    <div id="userMenu" class="hidden flex items-center space-x-3">
                        <img id="userAvatar" class="w-8 h-8 rounded-full" src="" alt="Avatar">
                        <span id="userName" class="text-sm"></span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-20 pb-10">
        <!-- Hero Section -->
        <section class="container mx-auto px-4 py-16 text-center">
            <h1 class="text-6xl font-bold mb-6 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
                DEVS ARENA
            </h1>
            <p class="text-xl text-gray-300 mb-8 max-w-3xl mx-auto">
                The ultimate digital city for developers. Code, collaborate, learn, and build together in real-time.
            </p>
            <div class="flex justify-center space-x-4">
                <button onclick="showAuthModal('register')" class="px-8 py-3 bg-primary rounded-lg text-lg font-semibold hover:neon-glow transition">
                    Start Coding
                </button>
                <button onclick="scrollToSection('features')" class="px-8 py-3 glassmorphic rounded-lg text-lg font-semibold hover:neon-glow transition">
                    Explore Features
                </button>
            </div>
        </section>

        <!-- Dashboard -->
        <section id="dashboard" class="container mx-auto px-4 py-12">
            <h2 class="text-3xl font-bold mb-8">Developer Dashboard</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Stats Cards -->
                <div class="glassmorphic rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400">Reputation</p>
                            <p class="text-2xl font-bold" id="userReputation">0</p>
                        </div>
                        <i class="fas fa-medal text-yellow-500 text-2xl"></i>
                    </div>
                </div>
                <div class="glassmorphic rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400">Projects</p>
                            <p class="text-2xl font-bold" id="userProjects">0</p>
                        </div>
                        <i class="fas fa-code-branch text-primary text-2xl"></i>
                    </div>
                </div>
                <div class="glassmorphic rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400">Followers</p>
                            <p class="text-2xl font-bold" id="userFollowers">0</p>
                        </div>
                        <i class="fas fa-users text-green-500 text-2xl"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Real-time Chat -->
        <section id="chat" class="container mx-auto px-4 py-12">
            <h2 class="text-3xl font-bold mb-8">Real-time Chat</h2>
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Chat Rooms -->
                <div class="glassmorphic rounded-xl p-4 lg:col-span-1">
                    <h3 class="font-semibold mb-4">Chat Rooms</h3>
                    <div class="space-y-2">
                        <button class="chat-room w-full text-left p-3 rounded-lg hover:bg-slate-800 transition" data-room="global">
                            üåç Global Chat
                        </button>
                        <button class="chat-room w-full text-left p-3 rounded-lg hover:bg-slate-800 transition" data-room="frontend">
                            üíª Frontend
                        </button>
                        <button class="chat-room w-full text-left p-3 rounded-lg hover:bg-slate-800 transition" data-room="backend">
                            üöÄ Backend
                        </button>
                        <button class="chat-room w-full text-left p-3 rounded-lg hover:bg-slate-800 transition" data-room="ai">
                            ü§ñ AI & ML
                        </button>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-semibold mb-3">Online Users</h4>
                        <div id="onlineUsers" class="space-y-2">
                            <!-- Online users will appear here -->
                        </div>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div class="glassmorphic rounded-xl p-4 lg:col-span-3 flex flex-col">
                    <div class="flex-1 mb-4 h-96 overflow-y-auto" id="chatMessages">
                        <div class="text-center text-gray-500 py-8">
                            Select a chat room to start messaging
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <input type="text" id="messageInput" 
                               class="flex-1 bg-slate-800 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary"
                               placeholder="Type your message..." disabled>
                        <button id="sendMessage" class="bg-primary px-4 py-2 rounded-lg hover:neon-glow transition" disabled>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Project Sharing -->
        <section id="projects" class="container mx-auto px-4 py-12">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold">Project Hub</h2>
                <button onclick="showProjectModal()" class="bg-primary px-6 py-2 rounded-lg hover:neon-glow transition">
                    <i class="fas fa-plus mr-2"></i>New Project
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="projectsGrid">
                <!-- Projects will be loaded here -->
            </div>
        </section>

        <!-- AI Coding Assistant -->
        <section id="ai" class="container mx-auto px-4 py-12">
            <h2 class="text-3xl font-bold mb-8">AI Coding Assistant</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="glassmorphic rounded-xl p-6">
                    <div class="flex space-x-2 mb-4">
                        <button class="ai-mode active px-4 py-2 rounded-lg bg-primary">Code Generation</button>
                        <button class="ai-mode px-4 py-2 rounded-lg glassmorphic">Debug & Fix</button>
                        <button class="ai-mode px-4 py-2 rounded-lg glassmorphic">Explain Code</button>
                    </div>
                    
                    <textarea id="aiPrompt" class="w-full h-32 code-editor rounded-lg p-4 mb-4 focus:outline-none focus:ring-2 focus:ring-primary"
                              placeholder="Describe what you want to code..."></textarea>
                    
                    <button id="generateCode" class="w-full bg-primary py-3 rounded-lg font-semibold hover:neon-glow transition">
                        <i class="fas fa-robot mr-2"></i>Generate Code
                    </button>
                </div>
                
                <div class="glassmorphic rounded-xl p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-semibold">AI Response</h3>
                        <button id="copyCode" class="px-3 py-1 glassmorphic rounded text-sm">
                            <i class="fas fa-copy mr-1"></i>Copy
                        </button>
                    </div>
                    <pre id="aiOutput" class="code-editor rounded-lg p-4 h-64 overflow-auto">
// Your generated code will appear here
                    </pre>
                </div>
            </div>
        </section>

        <!-- Add more sections for APIs, Devs School, Tools, etc. -->

    </main>

    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="glassmorphic rounded-xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold" id="authModalTitle">Login to DEVS ARENA</h3>
                <button onclick="hideAuthModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="authForm">
                <div id="registerFields" class="space-y-4 mb-4 hidden">
                    <input type="text" name="name" placeholder="Full Name" 
                           class="w-full bg-slate-800 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                    <select name="role" class="w-full bg-slate-800 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">Select Role</option>
                        <option value="frontend">Frontend Developer</option>
                        <option value="backend">Backend Developer</option>
                        <option value="fullstack">Full-stack Developer</option>
                        <option value="designer">Designer</option>
                        <option value="student">Student</option>
                    </select>
                    <select name="level" class="w-full bg-slate-800 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">Select Level</option>
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="pro">Pro</option>
                    </select>
                </div>
                
                <input type="email" name="email" placeholder="Email" 
                       class="w-full bg-slate-800 rounded-lg px-4 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-primary">
                <input type="password" name="password" placeholder="Password" 
                       class="w-full bg-slate-800 rounded-lg px-4 py-2 mb-6 focus:outline-none focus:ring-2 focus:ring-primary">
                
                <button type="submit" class="w-full bg-primary py-3 rounded-lg font-semibold hover:neon-glow transition mb-4">
                    Continue
                </button>
            </form>
            
            <div class="text-center">
                <button onclick="loginWithGitHub()" class="w-full glassmorphic py-3 rounded-lg font-semibold hover:neon-glow transition mb-4">
                    <i class="fab fa-github mr-2"></i>Continue with GitHub
                </button>
                
                <p class="text-gray-400">
                    <span id="authSwitchText">Don't have an account?</span>
                    <button id="authSwitch" class="text-primary ml-1 hover:underline">
                        Sign up
                    </button>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let socket = null;
        let currentUser = null;
        let currentChatRoom = null;

        // DOM Content Loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            checkAuthStatus();
        });

        function initializeApp() {
            // Connect to Socket.IO
            socket = io();
            
            // Socket event listeners
            socket.on('connect', () => {
                console.log('Connected to server');
                if (currentUser) {
                    socket.emit('user_online', currentUser);
                }
            });

            socket.on('chat_message', (data) => {
                displayChatMessage(data);
            });

            socket.on('online_users', (users) => {
                updateOnlineUsers(users);
            });

            socket.on('user_joined', (data) => {
                displaySystemMessage(`${data.username} joined the chat`);
            });

            socket.on('user_left', (data) => {
                displaySystemMessage(`${data.username} left the chat`);
            });
        }

        function setupEventListeners() {
            // Chat room selection
            document.querySelectorAll('.chat-room').forEach(button => {
                button.addEventListener('click', function() {
                    joinChatRoom(this.dataset.room);
                });
            });

            // Send message
            document.getElementById('sendMessage').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });

            // AI Assistant
            document.getElementById('generateCode').addEventListener('click', generateCodeWithAI);
            document.getElementById('copyCode').addEventListener('click', copyAICode);

            // Auth modal switching
            document.getElementById('authSwitch').addEventListener('click', toggleAuthMode);
            document.getElementById('authForm').addEventListener('submit', handleAuthSubmit);

            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        }

        // Authentication Functions
        function showAuthModal(mode) {
            const modal = document.getElementById('authModal');
            const title = document.getElementById('authModalTitle');
            const registerFields = document.getElementById('registerFields');
            const switchText = document.getElementById('authSwitchText');
            const switchBtn = document.getElementById('authSwitch');

            if (mode === 'register') {
                title.textContent = 'Join DEVS ARENA';
                registerFields.classList.remove('hidden');
                switchText.textContent = 'Already have an account?';
                switchBtn.textContent = 'Sign in';
            } else {
                title.textContent = 'Login to DEVS ARENA';
                registerFields.classList.add('hidden');
                switchText.textContent = "Don't have an account?";
                switchBtn.textContent = 'Sign up';
            }

            modal.classList.remove('hidden');
        }

        function hideAuthModal() {
            document.getElementById('authModal').classList.add('hidden');
        }

        function toggleAuthMode() {
            const currentMode = document.getElementById('authModalTitle').textContent.includes('Login') ? 'login' : 'register';
            showAuthModal(currentMode === 'login' ? 'register' : 'login');
        }

        async function handleAuthSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            const isRegister = document.getElementById('registerFields').classList.contains('hidden') ? false : true;

            try {
                const response = await fetch('/api/auth/' + (isRegister ? 'register' : 'login'), {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    localStorage.setItem('token', result.token);
                    currentUser = result.user;
                    updateUIAfterAuth();
                    hideAuthModal();
                    loadUserData();
                } else {
                    alert(result.message || 'Authentication failed');
                }
            } catch (error) {
                console.error('Auth error:', error);
                alert('Authentication failed');
            }
        }

        function loginWithGitHub() {
            window.location.href = '/auth/github';
        }

        function checkAuthStatus() {
            const token = localStorage.getItem('token');
            if (token) {
                // Verify token and get user data
                fetch('/api/auth/me', {
                    headers: { 'Authorization': `Bearer ${token}` }
                })
                .then(response => response.json())
                .then(user => {
                    if (user) {
                        currentUser = user;
                        updateUIAfterAuth();
                        loadUserData();
                    }
                })
                .catch(() => {
                    localStorage.removeItem('token');
                });
            }
        }

        function updateUIAfterAuth() {
            document.getElementById('authButtons').classList.add('hidden');
            document.getElementById('userMenu').classList.remove('hidden');
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userAvatar').src = currentUser.avatar || '/default-avatar.png';
            
            // Enable chat features
            document.getElementById('messageInput').disabled = false;
            document.getElementById('sendMessage').disabled = false;
        }

        // Chat Functions
        function joinChatRoom(room) {
            if (currentChatRoom) {
                socket.emit('leave_room', currentChatRoom);
            }
            
            currentChatRoom = room;
            socket.emit('join_room', room);
            
            document.getElementById('chatMessages').innerHTML = '';
            displaySystemMessage(`Joined ${room} chat room`);
            
            // Update active room highlight
            document.querySelectorAll('.chat-room').forEach(btn => {
                btn.classList.remove('bg-primary');
                if (btn.dataset.room === room) {
                    btn.classList.add('bg-primary');
                }
            });
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message && currentChatRoom && currentUser) {
                socket.emit('send_message', {
                    room: currentChatRoom,
                    message: message,
                    user: currentUser
                });
                input.value = '';
            }
        }

        function displayChatMessage(data) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'mb-3';
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-2">
                    <img src="${data.user.avatar || '/default-avatar.png'}" 
                         class="w-8 h-8 rounded-full mt-1">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <span class="font-semibold">${data.user.name}</span>
                            <span class="text-xs text-gray-400">${new Date().toLocaleTimeString()}</span>
                        </div>
                        <p class="text-gray-200">${data.message}</p>
                    </div>
                </div>
            `;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function displaySystemMessage(message) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'text-center text-gray-500 text-sm mb-3';
            messageDiv.textContent = message;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function updateOnlineUsers(users) {
            const usersDiv = document.getElementById('onlineUsers');
            usersDiv.innerHTML = users.map(user => `
                <div class="flex items-center space-x-2 p-2 rounded-lg hover:bg-slate-800">
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <img src="${user.avatar || '/default-avatar.png'}" class="w-6 h-6 rounded-full">
                    <span class="text-sm">${user.name}</span>
                </div>
            `).join('');
        }

        // AI Functions
        async function generateCodeWithAI() {
            const prompt = document.getElementById('aiPrompt').value;
            if (!prompt.trim()) return;

            const generateBtn = document.getElementById('generateCode');
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            generateBtn.disabled = true;

            try {
                const response = await fetch('/api/ai/generate-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ prompt })
                });

                const result = await response.json();
                document.getElementById('aiOutput').textContent = result.code || 'Error generating code';
            } catch (error) {
                console.error('AI error:', error);
                document.getElementById('aiOutput').textContent = 'Error generating code';
            } finally {
                generateBtn.innerHTML = '<i class="fas fa-robot mr-2"></i>Generate Code';
                generateBtn.disabled = false;
            }
        }

        function copyAICode() {
            const code = document.getElementById('aiOutput').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.getElementById('copyCode');
                btn.innerHTML = '<i class="fas fa-check mr-1"></i>Copied!';
                setTimeout(() => {
                    btn.innerHTML = '<i class="fas fa-copy mr-1"></i>Copy';
                }, 2000);
            });
        }

        // Utility Functions
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            const icon = document.querySelector('#themeToggle i');
            icon.classList.toggle('fa-moon');
            icon.classList.toggle('fa-sun');
        }

        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
        }

        async function loadUserData() {
            try {
                const response = await fetch('/api/user/profile', {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('userReputation').textContent = data.reputation || 0;
                    document.getElementById('userProjects').textContent = data.projectsCount || 0;
                    document.getElementById('userFollowers').textContent = data.followersCount || 0;
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function showProjectModal() {
            if (!currentUser) {
                showAuthModal('login');
                return;
            }
            // Implementation for project modal
            alert('Project creation modal will be implemented with backend');
        }

        // Load projects on page load
        async function loadProjects() {
            try {
                const response = await fetch('/api/projects');
                const projects = await response.json();
                const grid = document.getElementById('projectsGrid');
                
                grid.innerHTML = projects.map(project => `
                    <div class="glassmorphic rounded-xl p-4">
                        <img src="${project.screenshot || '/default-project.png'}" 
                             class="w-full h-48 object-cover rounded-lg mb-4">
                        <h3 class="font-semibold text-lg mb-2">${project.title}</h3>
                        <p class="text-gray-400 text-sm mb-4">${project.description}</p>
                        <div class="flex justify-between items-center">
                            <div class="flex space-x-2">
                                <button class="text-gray-400 hover:text-red-500">
                                    <i class="fas fa-heart"></i> ${project.likes || 0}
                                </button>
                                <button class="text-gray-400 hover:text-blue-500">
                                    <i class="fas fa-comment"></i> ${project.comments || 0}
                                </button>
                            </div>
                            <span class="text-xs glassmorphic px-2 py-1 rounded">${project.language}</span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }

        // Initialize projects load
        loadProjects();
    </script>
</body>
</html>
